<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
      /* Custom styles to enhance aesthetics and ensure responsiveness. */
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f0f4f8;
        padding: 20px;
      }
      .container {
        max-width: 100%;
        margin: auto;
        background-color: #ffffff;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      }
      .button-group button {
        transition: background-color 0.3s ease, transform 0.2s ease;
      }
      .button-group button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
      }
      .status-message {
        margin-top: 15px;
        padding: 10px;
        border-radius: 8px;
        font-size: 0.9em;
      }
      .status-success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .status-error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .scrollable-content::-webkit-scrollbar {
        width: 8px;
      }
      .scrollable-content::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 10px;
      }
      .scrollable-content::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 10px;
      }
      .scrollable-content::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    </style>
  </head>
  <body class="p-4 bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="container bg-white p-6 rounded-xl shadow-lg w-full max-w-sm">
      <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">Simpan Data Tersaring ke Drive</h1>

      <div class="scrollable-content max-h-96 overflow-y-auto pr-2">
        <div class="grid grid-cols-1 gap-3 button-group">
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Pascasarjana (Manajemen Pendidikan)')">
            Pascasarjana (Manajemen Pendidikan)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Ekonomi (Akuntansi)')">
            Ekonomi (Akuntansi)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Ekonomi (Manajemen)')">
            Ekonomi (Manajemen)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Teknik (Teknik Sipil)')">
            Teknik (Teknik Sipil)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Teknik (Ilmu Komputer)')">
            Teknik (Ilmu Komputer)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Teknik (Teknik Mesin)')">
            Teknik (Teknik Mesin)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('FIKES (Ilmu Keperawatan)')">
            FIKES (Ilmu Keperawatan)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('FIKES (Keselamatan dan Kesehatan Kerja)')">
            FIKES (Keselamatan dan Kesehatan Kerja)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('FIKES (Profesi Ners)')">
            FIKES (Profesi Ners)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('FKIP (Administrasi Pendidikan)')">
            FKIP (Administrasi Pendidikan)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Hukum (Ilmu Hukum)')">
            Hukum (Ilmu Hukum)
          </button>
          <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75" onclick="downloadDataToDrive('Sastra (Sastra Inggris)')">
            Sastra (Sastra Inggris)
          </button>
        </div>
      </div>

      <div id="status" class="status-message hidden mt-4 text-center"></div>
    </div>

    <script>
      /**
       * Displays a status message in the sidebar.
       * @param {string} message The message to display.
       * @param {boolean} isError True if the message indicates an error, false otherwise.
       */
      function showStatus(message, isError = false) {
        var statusDiv = document.getElementById('status');
        statusDiv.textContent = message;
        statusDiv.className = 'status-message';
        if (isError) {
          statusDiv.classList.add('status-error');
        } else {
          statusDiv.classList.add('status-success');
        }
        statusDiv.classList.remove('hidden');
      }

      /**
       * Initiates the data saving process to Google Drive by calling the Google Apps Script function.
       * @param {string} filterValue The value to pass to the Apps Script for filtering.
       */
      function downloadDataToDrive(filterValue) {
        showStatus('Memproses data "' + filterValue + '" untuk disimpan ke Drive...', false);

        // Call the server-side Apps Script function 'downloadFilteredDataToDrive'.
        google.script.run
          .withSuccessHandler(function(responseString) {
            try {
              var response = JSON.parse(responseString);
              if (response && response.url && response.fileId) {
                showStatus('File Google Sheet "' + filterValue + '" berhasil dibuat di folder "BANK PENGOLAHAN EXCEL".', false);
                // Opsional: Buka file di tab baru
                window.open(response.url, '_blank');
              } else {
                showStatus(responseString, responseString.includes('Error:') || responseString.includes('No data found'));
              }
            } catch (e) {
              showStatus('Error parsing server response or invalid response format: ' + e.message + '. Response: ' + responseString, true);
            }
          })
          .withFailureHandler(function(error) {
            showStatus('Error: ' + error.message, true);
          })
          .downloadFilteredDataToDrive(filterValue); // Pass the filter value to Apps Script.
      }
    </script>
  </body>
</html>